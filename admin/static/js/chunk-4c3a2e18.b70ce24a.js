(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c3a2e18","chunk-4c1673b3","chunk-1fd63afd"],{"1f34":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{md:5,xs:24}},[a("a-card",{attrs:{bordered:!1}},[a("a-spin",{attrs:{spinning:e.deptLoading}},[a("div",[e.deptLoading?e._e():a("a-tree",{attrs:{"tree-data":e.treeData,"default-expand-all":""},on:{select:e.handleSelect}})],1)])],1)],1),a("a-col",{attrs:{md:19,xs:24}},[a("a-card",{attrs:{bordered:!1}},[a("div",{directives:[{name:"action",rawName:"v-action:insert",arg:"insert"}],staticClass:"mb-2"},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(t){return e.$refs.editForm.handleInsert()}}},[e._v("新增用户")])],1),a("a-table",{attrs:{columns:e.columns,"data-source":e.list,pagination:e.pagination,loading:e.loading,"row-key":"id",size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"status",fn:function(e){return[a("x-status",{attrs:{code:e}})]}},{key:"operation",fn:function(t,i){return[a("span",{directives:[{name:"action",rawName:"v-action:setAuth",arg:"setAuth"}]},["1"===i.type?a("a-tooltip",{attrs:{title:"超级管理员拥有所有权限",trigger:"click"}},[a("a",[e._v("设置权限")])]):a("a",{on:{click:function(t){return e.$refs.authForm.handleEdit(i)}}},[e._v("设置权限")]),a("a-divider",{attrs:{type:"vertical"}})],1),a("span",{directives:[{name:"action",rawName:"v-action:edit",arg:"edit"}]},[a("a",{on:{click:function(t){return e.$refs.editForm.handleEdit(i)}}},[e._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}})],1),a("span",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}]},[a("a-popconfirm",{attrs:{title:"确认删除此数据?"},on:{confirm:function(t){return e.$refs.editForm.handleDelete(i)}}},[a("a",[e._v("删除")])])],1)]}}])})],1)],1)],1),a("edit-form",{ref:"editForm",on:{complete:e.onComplete}}),a("auth-form",{ref:"authForm",attrs:{type:"2"}})],1)},n=[],r=(a("9302"),a("513c"),a("80a0")),s=a("59e3"),o=a("e25f"),d=[{title:"用户名",dataIndex:"username"},{title:"姓名",dataIndex:"full_name"},{title:"角色",dataIndex:"role_name"},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"}}],c={name:"index",components:{EditForm:s["default"],AuthForm:o["default"]},data:function(){return{columns:d,list:[],pagination:{showSizeChanger:!0},loading:!1,deptList:[],deptLoading:!1,deptId:""}},created:function(){this.getDeptList(),this.getList()},computed:{treeData:function(){return this.$xy.util.changeKeys(this.deptList,{title:"name",value:"id",key:"id",children:"children",parentId:"parent_id"})}},methods:{getList:function(){var e=this;this.loading=!0,this.$api.system.user.getList({current_page:this.pagination.current,page_size:this.pagination.pageSize,dept_id:this.deptId}).then((function(t){var a=t.code,i=t.data,n=i.list,s=i.total;e.loading=!1,"200"===a&&(e.pagination=Object(r["a"])(Object(r["a"])({},e.pagination),{},{total:Number(s)}),e.list=n)})).catch((function(){e.loading=!1}))},getDeptList:function(){var e=this;this.deptLoading=!0,this.$api.system.dept.getList({status:"1"}).then((function(t){var a=t.code,i=t.data.list;"200"===a&&(e.deptList=i),e.$nextTick((function(){e.deptLoading=!1}))})).catch((function(){e.deptLoading=!1}))},handleTableChange:function(e){this.pagination=Object(r["a"])(Object(r["a"])({},this.pagination),{},{current:e.current,pageSize:e.pageSize}),this.getList()},handleSelect:function(e){this.deptId=this.$xy.util.getFieldsValue(this.treeData,{parentField:"parentId",parentId:e[0]||"",field:"key"}).join(","),this.getList()},onComplete:function(){this.getList()}}},l=c,u=a("4023"),m=Object(u["a"])(l,i,n,!1,null,"c26d7c22",null);t["default"]=m.exports},"59e3":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:e.title,"confirm-loading":e.confirmLoading},on:{ok:e.onOk,cancel:e.onCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-form",e._b({attrs:{form:e.form}},"a-form",e.formItemLayout,!1),[a("a-form-item",{attrs:{label:"用户名"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,message:"请输入用户名"}]}],expression:"['username',{rules:[{required:true,message:'请输入用户名'}]}]"}]})],1),a("a-form-item",{attrs:{label:"密码",extra:e.isRequiredPassword?"":"不填写则不修改"}},[a("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:e.isRequiredPassword,message:"请输入密码"},{validator:e.verifyPassword}]}],expression:"['password',{rules:[{required:isRequiredPassword,message:'请输入密码'},{validator:verifyPassword}]}]"}],attrs:{"allow-clear":""}})],1),a("a-form-item",{attrs:{label:"角色"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_id",{rules:[{required:!0,message:"请输入选择角色"}]}],expression:"['role_id',{rules:[{required:true,message:'请输入选择角色'}]}]"}],attrs:{mode:"multiple",loading:e.roleLoading,disabled:e.isSuper}},e._l(e.roleList,(function(t){return a("a-select-option",{key:t.id},[e._v(e._s(t.name))])})),1)],1),a("a-form-item",{attrs:{label:"部门"}},[a("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["dept_id"],expression:"['dept_id']"}],attrs:{"tree-data":e.treeData}})],1),a("a-form-item",{attrs:{label:"岗位"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["post_id"],expression:"['post_id']"}],attrs:{loading:e.postLoading}},e._l(e.postList,(function(t){return a("a-select-option",{key:t.id},[e._v(e._s(t.name)+" ")])})),1)],1),a("a-form-item",{attrs:{label:"姓名"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["full_name"],expression:"['full_name']"}]})],1),a("a-form-item",{attrs:{label:"手机"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mobile"],expression:"['mobile']"}]})],1),a("a-form-item",{attrs:{label:"邮箱"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email"],expression:"['email']"}]})],1),a("a-form-item",{attrs:{label:"状态"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:"1"}],expression:"['status',{initialValue:'1'}]"}],attrs:{disabled:e.isSuper}},[a("a-radio",{attrs:{value:"1"}},[e._v("正常")]),a("a-radio",{attrs:{value:"0"}},[e._v("禁用")])],1)],1),a("a-form-item",{attrs:{label:"排序"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:"99"}],expression:"['sort',{initialValue:'99'}]"}]})],1)],1)],1)},n=[],r=(a("e35a"),a("0d7a"),a("6db4"),a("b449"),a("5d83")),s=a("e49c"),o={mixins:[s["default"]],data:function(){return{roleList:[],roleLoading:!1,postList:[],postLoading:!1,isRequiredPassword:!1}},watch:{visible:function(e){e&&(this.roleList.length||this.getRoleList(),this.postList.length||this.getPostList())}},computed:{treeData:function(){return this.$parent.treeData},isSuper:function(){return"1"===this.record.type}},methods:{verifyPassword:function(e,t,a){t&&t.trim().length<6&&a("密码长度至少6位"),a()},getRoleList:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.roleLoading=!0,t.next=3,e.$api.system.role.getList({status:"1",has_pagination:"0"});case 3:a=t.sent,i=a.code,n=a.data.list,e.roleLoading=!1,"200"===i&&(e.roleList=n);case 8:case"end":return t.stop()}}),t)})))()},getPostList:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.postLoading=!0,t.next=3,e.$api.system.post.getList({status:"1",has_pagination:"0"});case 3:a=t.sent,i=a.code,n=a.data.list,e.postLoading=!1,"200"===i&&(e.postList=n);case 8:case"end":return t.stop()}}),t)})))()},handleInsert:function(){var e=this;this.toggleModal(),this.title="新增用户",this.$nextTick((function(){var t=e.$parent.deptId.split(",").length?e.$parent.deptId.split(",")[0]:"";e.isRequiredPassword=!0,e.form.setFieldsValue({dept_id:t})}))},handleEdit:function(e){var t=this;this.toggleModal(),this.record=e,this.title="编辑用户",this.$nextTick((function(){t.isRequiredPassword=!1,t.form.setFieldsValue({username:e.username,role_id:e.role_id,dept_id:e.dept_id,post_id:e.post_id,full_name:e.full_name,mobile:e.mobile,email:e.email,status:e.status,sort:e.sort})}))},handleDelete:function(e){var t=this;this.$api.system.user.delete({id:e.id}).then((function(a){var i=a.code;"200"===i&&(t.$emit("delete",e),t.$emit("complete",e))}))},onOk:function(){var e=this;this.form.validateFieldsAndScroll((function(t,a){t||(e.confirmLoading=!0,e.$api.system.user.submit({id:e.record.id,username:a.username,password:a.password,role_id:a.role_id,dept_id:a.dept_id,post_id:a.post_id,full_name:a.full_name,mobile:a.mobile,email:a.email,status:a.status,sort:a.sort}).then((function(t){var i=t.code;e.confirmLoading=!1,"200"===i&&(e.reset(),e.toggleModal(),e.$emit("ok",a),e.$emit("complete",a))}),(function(t){e.confirmLoading=!1})))}))},onCancel:function(){this.reset(),this.toggleModal(),this.$emit("cancel")}}},d=o,c=a("4023"),l=Object(c["a"])(d,i,n,!1,null,"8279f5ac",null);t["default"]=l.exports},"6db4":function(e,t,a){"use strict";var i=a("1c8b"),n=a("c10f").trim,r=a("f221");i({target:"String",proto:!0,forced:r("trim")},{trim:function(){return n(this)}})},9092:function(e,t,a){},e25f:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:e.title,"confirm-loading":e.confirmLoading,width:"640px"},on:{ok:e.onOk,cancel:e.onCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-spin",{attrs:{spinning:e.spinning}},[e.list.length?a("a-tree",{staticClass:"auth-tree",attrs:{"tree-data":e.list,"default-expand-all":"",checkable:"","check-strictly":!1},on:{check:e.onCheck},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}}):e._e()],1)],1)},n=[],r=(a("b4fb"),a("fe59"),a("2eeb"),a("513c"),a("e35a"),a("0d7a"),a("08ba"),a("5c62")),s=(a("b449"),a("5d83")),o=a("e49c"),d=void 0,c=function e(t){return d.$xy.util.changeKeys(t,{title:"name",value:"id",key:"id",children:function(t){if(t.children&&t.children.length)return e(t.children);if(t.auth_id){var a=t.auth_id.split(","),i=t.auth_name.split(",");return i.map((function(e,i){return{class:"last-tree-node",title:e,value:"".concat(t.id,",").concat(a[i]),key:"".concat(t.id,",").concat(a[i])}}))}}})},l={props:{type:{type:[Number,String],default:1}},mixins:[o["default"]],data:function(){return{list:[],spinning:!1,checkedKeys:[],halfCheckedKeys:[]}},created:function(){this.title="设置权限"},watch:{visible:function(e){e&&!this.list.length&&this.getMenuList()}},methods:{getMenuList:function(){var e=this;this.spinning=!0;var t=this.$ls.get("userInfo"),a=t.id;this.$api.system.auth.getMenuList({id:a,type:"2"}).then((function(t){var a=t.code,i=t.data.list;e.spinning=!1,"200"===a&&(e.list=c(i))}))},getAlreadyAuthList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.spinning=!0,t.next=3,e.$api.system.auth.getAlreadyAuthList({id:e.record.id,type:e.type});case 3:a=t.sent,i=a.code,n=a.data.list,e.spinning=!1,"200"===i&&(r=[],s=[],n.forEach((function(e){s.push(e.menu_id),e.auth_button_id&&e.auth_button_id.split(",").forEach((function(t){r.push("".concat(e.menu_id,",").concat(t))}))})),e.checkedKeys=r,e.halfCheckedKeys=s);case 8:case"end":return t.stop()}}),t)})))()},handleEdit:function(e){this.toggleModal(),this.record=e,this.getAlreadyAuthList()},onCheck:function(e,t){var a=t.halfCheckedKeys;this.halfCheckedKeys=a},onOk:function(){var e=this;this.confirmLoading=!0;var t=[].concat(Object(r["a"])(this.formatValues(this.checkedKeys)),Object(r["a"])(this.formatValues(this.halfCheckedKeys,"1")));this.$api.system.auth.submit({id:this.record.id,type:this.type,values:t}).then((function(t){var a=t.code;e.confirmLoading=!1,"200"===a&&(e.reset(),e.toggleModal(),e.$emit("ok"),e.$emit("complete"))}))},onCancel:function(){this.reset(),this.toggleModal(),this.$emit("cancel")},formatValues:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",i=e.map((function(e){var i=e.split(","),n=2==i.length?i[0]:e,r=2==i.length?i[1]:"";return{id:t.record.id,type:t.type,menu_id:n,auth_button_id:r,is_half:a}}));return i}}},u=l,m=(a("fa9f"),a("4023")),p=Object(m["a"])(u,i,n,!1,null,"1b92e9d4",null);t["default"]=p.exports},f221:function(e,t,a){var i=a("efe2"),n=a("fc8cf"),r="​᠎";e.exports=function(e){return i((function(){return!!n[e]()||r[e]()!=r||n[e].name!==e}))}},fa9f:function(e,t,a){"use strict";var i=a("9092"),n=a.n(i);n.a}}]);